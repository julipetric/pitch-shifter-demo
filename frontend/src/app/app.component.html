<mat-toolbar color="primary">
  <span>{{ title }}</span>
</mat-toolbar>
<main>
  <mat-card class="transport-card">
    <mat-card-header>
      <mat-card-title>Audio Transport</mat-card-title>
      <mat-card-subtitle>Streaming from backend</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="controls">
        <button mat-raised-button color="primary" (click)="togglePlay()">
          {{ isPlaying ? 'Pause' : 'Play' }}
        </button>
      </div>

      <div class="slider-group">
        <label class="slider-label" for="seek-slider">Seek</label>
        <mat-slider [min]="0" [max]="duration" [step]="0.1" [disabled]="duration === 0">
          <input
            matSliderThumb
            id="seek-slider"
            [value]="seekValue"
            (input)="onSeekInput($event)"
            (change)="onSeekCommit($event)"
          />
        </mat-slider>
        <div class="time">
          {{ formatTime(currentTime) }} / {{ formatTime(duration) }}
        </div>
      </div>

      <div class="slider-group">
        <label class="slider-label" for="volume-slider">Volume</label>
        <mat-slider [min]="0" [max]="1" [step]="0.01">
          <input matSliderThumb id="volume-slider" [value]="volume" (input)="onVolumeInput($event)" />
        </mat-slider>
      </div>

      <div class="slider-group">
        <label class="slider-label" for="tempo-slider">Tempo ({{ tempoPercent }}%)</label>
        <mat-slider [min]="tempoMin" [max]="tempoMax" [step]="1">
          <input matSliderThumb id="tempo-slider" [value]="tempoPercent" (input)="onTempoInput($event)" />
        </mat-slider>
      </div>

      <div class="toggle-group">
        <mat-slide-toggle [checked]="preservePitch" (change)="onPreservePitchChange($event)">
          Preserve pitch
        </mat-slide-toggle>
      </div>

      <div class="slider-group">
        <label class="slider-label" for="pitch-slider">Pitch ({{ pitchSemitones }} st)</label>
        <mat-slider [min]="pitchMin" [max]="pitchMax" [step]="pitchStep">
          <input
            matSliderThumb
            id="pitch-slider"
            [value]="pitchSemitones"
            (input)="onPitchInput($event)"
            (change)="onPitchCommit($event)"
          />
        </mat-slider>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="waveform-card">
    <mat-card-header>
      <mat-card-title>Waveform</mat-card-title>
      <mat-card-subtitle>Original vs processed</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="waveform-panel">
        <div class="waveform-window">
          <div class="waveform-label">Original</div>
          <app-waveform-snippet [streamUrl]="originalStreamUrl" [progress]="originalProgress" />
        </div>
        <div class="waveform-window" [class.hidden]="!isProcessingActive">
          <div class="waveform-label">Processed</div>
          <app-waveform-snippet
            [streamUrl]="isProcessingActive ? streamUrl : null"
            [progress]="processedProgress"
            [deferColoring]="true"
          />
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <audio
    #audioRef
    [src]="streamUrl"
    preload="metadata"
    (play)="onPlay()"
    (pause)="onPause()"
    (ended)="onEnded()"
    (timeupdate)="onTimeUpdate()"
    (loadedmetadata)="onLoadedMetadata()"
    (canplay)="onCanPlay()"
  ></audio>
</main>
